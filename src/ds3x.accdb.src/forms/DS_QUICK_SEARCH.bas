Version =20
VersionRequired =20
Begin Form
    PopUp = NotDefault
    RecordSelectors = NotDefault
    FastLaserPrinting = NotDefault
    MaxButton = NotDefault
    MinButton = NotDefault
    ControlBox = NotDefault
    AutoCenter = NotDefault
    NavigationButtons = NotDefault
    AllowDeletions = NotDefault
    CloseButton = NotDefault
    DividingLines = NotDefault
    AllowAdditions = NotDefault
    KeyPreview = NotDefault
    DefaultView =0
    ScrollBars =0
    ViewsAllowed =1
    TabularCharSet =177
    TabularFamily =0
    BorderStyle =0
    PictureAlignment =2
    DatasheetGridlinesBehavior =3
    GridY =10
    Width =5018
    DatasheetFontHeight =11
    ItemSuffix =1447
    Left =4065
    Top =2775
    Right =28545
    Bottom =15345
    OnUnload ="[Event Procedure]"
    RecSrcDt = Begin
        0x4a0577b4d2d8e540
    End
    Caption ="🔎"
    DatasheetFontName ="Calibri"
    OnKeyDown ="[Event Procedure]"
    OnTimer ="[Event Procedure]"
    OnLoad ="[Event Procedure]"
    AllowDatasheetView =0
    FilterOnLoad =0
    SplitFormDatasheet =1
    SplitFormDatasheet =1
    ShowPageMargins =0
    DisplayOnSharePointSite =1
    AllowLayoutView =0
    DatasheetAlternateBackColor =15921906
    DatasheetGridlinesColor12 =0
    FitToScreen =255
    DatasheetBackThemeColorIndex =1
    BorderThemeColorIndex =3
    ThemeFontIndex =1
    ForeThemeColorIndex =0
    AlternateBackThemeColorIndex =1
    AlternateBackShade =95.0
    WaitForPostProcessing =255
    Begin
        Begin Label
            BackStyle =0
            FontSize =11
            FontName ="Calibri"
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =0
            BorderTint =50.0
            ForeThemeColorIndex =0
            ForeTint =50.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin Rectangle
            SpecialEffect =3
            BackStyle =0
            BorderLineStyle =0
            Width =850
            Height =850
            BorderShade =65.0
            GridlineShade =65.0
        End
        Begin Line
            BorderLineStyle =0
            Width =1701
            BorderThemeColorIndex =0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin CommandButton
            Width =1701
            Height =283
            FontSize =11
            FontWeight =400
            FontName ="Calibri"
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
            UseTheme =1
            Shape =1
            Gradient =12
            BackThemeColorIndex =4
            BackTint =60.0
            BorderLineStyle =0
            BorderThemeColorIndex =4
            BorderTint =60.0
            ThemeFontIndex =1
            HoverThemeColorIndex =4
            HoverTint =40.0
            PressedThemeColorIndex =4
            PressedShade =75.0
            HoverForeThemeColorIndex =0
            HoverForeTint =75.0
            PressedForeThemeColorIndex =0
            PressedForeTint =75.0
        End
        Begin OptionButton
            BorderLineStyle =0
            LabelX =230
            LabelY =-30
            BorderThemeColorIndex =1
            BorderShade =65.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin CheckBox
            BorderLineStyle =0
            LabelX =230
            LabelY =-30
            BorderThemeColorIndex =1
            BorderShade =65.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin OptionGroup
            SpecialEffect =3
            BorderLineStyle =0
            Width =1701
            Height =1701
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin BoundObjectFrame
            AddColon = NotDefault
            SizeMode =3
            SpecialEffect =2
            BorderLineStyle =0
            Width =4536
            Height =2835
            LabelX =-1701
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin TextBox
            AddColon = NotDefault
            FELineBreak = NotDefault
            BorderLineStyle =0
            Width =1701
            LabelX =-1701
            FontSize =11
            FontName ="Calibri"
            AsianLineBreak =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ThemeFontIndex =1
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin ListBox
            BorderLineStyle =0
            Width =1701
            Height =1417
            LabelX =-1701
            FontSize =11
            FontName ="Calibri"
            AllowValueListEdits =1
            InheritValueList =1
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin ComboBox
            AddColon = NotDefault
            BorderLineStyle =0
            Width =1701
            LabelX =-1701
            FontSize =11
            FontName ="Calibri"
            AllowValueListEdits =1
            InheritValueList =1
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ForeThemeColorIndex =2
            ForeShade =50.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin Subform
            BorderLineStyle =0
            Width =1701
            Height =1701
            BorderThemeColorIndex =1
            GridlineThemeColorIndex =1
            GridlineShade =65.0
            BorderShade =65.0
            ShowPageHeaderAndPageFooter =1
        End
        Begin PageBreak
            Width =283
        End
        Begin Tab
            Width =5103
            Height =3402
            FontSize =11
            FontName ="Calibri"
            ThemeFontIndex =0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
            UseTheme =1
            Shape =3
            BackThemeColorIndex =1
            BackShade =85.0
            BorderLineStyle =0
            BorderThemeColorIndex =2
            BorderTint =60.0
            HoverThemeColorIndex =1
            PressedThemeColorIndex =1
            HoverForeThemeColorIndex =0
            HoverForeTint =75.0
            PressedForeThemeColorIndex =0
            PressedForeTint =75.0
            ForeThemeColorIndex =0
            ForeTint =75.0
        End
        Begin Page
            Width =1701
            Height =1701
            BorderThemeColorIndex =1
            BorderShade =65.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin EmptyCell
            Height =240
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin NavigationControl
            BorderWidth =1
            BorderLineStyle =0
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin NavigationButton
            Width =283
            Height =283
            ForeColor =-2
            GridlineThemeColorIndex =1
            GridlineShade =65.0
            HoverColor =-2
            HoverThemeColorIndex =2
            HoverTint =20.0
            PressedColor =-2
            PressedThemeColorIndex =2
            PressedTint =60.0
            HoverForeColor =-2
            HoverForeThemeColorIndex =0
            HoverForeTint =75.0
            PressedForeColor =-2
            PressedForeThemeColorIndex =0
            PressedForeTint =75.0
            BackThemeColorIndex =1
            OldBorderStyle =0
            BorderLineStyle =0
            BorderThemeColorIndex =3
            BorderShade =90.0
            ThemeFontIndex =1
            FontName ="Calibri"
            FontWeight =400
            FontSize =11
            ForeThemeColorIndex =0
            ForeTint =75.0
        End
        Begin Section
            CanGrow = NotDefault
            CanShrink = NotDefault
            Height =743
            Name ="Detalle"
            AlternateBackThemeColorIndex =4
            AlternateBackTint =40.0
            BackThemeColorIndex =1
            BackShade =95.0
            Begin
                Begin CommandButton
                    TabStop = NotDefault
                    OverlapFlags =93
                    TextFontCharSet =177
                    TextFontFamily =0
                    Left =284
                    Top =284
                    Width =15
                    Height =15
                    FontSize =1
                    FontWeight =100
                    TabIndex =4
                    Name ="HiddenControl"
                    Caption ="Comando1435"
                    LeftPadding =0
                    TopPadding =0
                    RightPadding =0
                    BottomPadding =0
                    GridlineColor =10921638
                    BackStyle =0

                    LayoutCachedLeft =284
                    LayoutCachedTop =284
                    LayoutCachedWidth =299
                    LayoutCachedHeight =299
                    Alignment =1
                    ForeThemeColorIndex =1
                    ForeTint =100.0
                    Shape =0
                    Gradient =0
                    BackThemeColorIndex =1
                    BackTint =100.0
                    OldBorderStyle =0
                    BorderThemeColorIndex =1
                    BorderTint =100.0
                    HoverColor =-2
                    HoverThemeColorIndex =-1
                    HoverTint =80.0
                    PressedColor =-2
                    PressedThemeColorIndex =-1
                    PressedShade =80.0
                    HoverForeColor =0
                    HoverForeTint =100.0
                    PressedForeColor =0
                    PressedForeTint =100.0
                    QuickStyle =4
                    QuickStyleMask =-1009
                    Overlaps =1
                End
                Begin Rectangle
                    SpecialEffect =0
                    BackStyle =1
                    OverlapFlags =223
                    Left =15
                    Top =15
                    Width =4995
                    Height =720
                    Name ="bg01"
                    GroupTable =3
                    LeftPadding =0
                    TopPadding =0
                    RightPadding =0
                    BottomPadding =0
                    GridlineStyleLeft =1
                    GridlineStyleTop =1
                    GridlineStyleBottom =1
                    GridlineWidthRight =0
                    LayoutCachedLeft =15
                    LayoutCachedTop =15
                    LayoutCachedWidth =5010
                    LayoutCachedHeight =735
                    LayoutGroup =2
                    BackThemeColorIndex =1
                    BackShade =95.0
                    GridlineThemeColorIndex =1
                    GridlineShade =40.0
                    GroupTable =3
                End
                Begin TextBox
                    AllowAutoCorrect = NotDefault
                    OverlapFlags =223
                    TextFontCharSet =177
                    TextAlign =1
                    TextFontFamily =0
                    IMESentenceMode =3
                    Left =1275
                    Top =180
                    Width =2400
                    Height =345
                    FontSize =10
                    FontWeight =100
                    TabIndex =1
                    LeftMargin =170
                    TopMargin =58
                    BorderColor =16777215
                    ForeColor =5855577
                    Name ="INPUT_SEARCH"
                    StatusBarText ="MAXLEN=2048"
                    FontName ="Calibri Light"
                    OnChange ="[Event Procedure]"
                    Tag ="BKP: MAXLEN=32;APPLY=UCASE;REGEX=^([a-zA-Z0-9_\\sáéíóúàèìòùÁÉÍÓÚÀÈÌÒÙ]+)$"
                    GroupTable =1
                    LeftPadding =0
                    TopPadding =15
                    RightPadding =0
                    BottomPadding =0
                    GridlineStyleTop =1
                    GridlineStyleBottom =1
                    GridlineColor =8355711
                    ShowDatePicker =0

                    LayoutCachedLeft =1275
                    LayoutCachedTop =180
                    LayoutCachedWidth =3675
                    LayoutCachedHeight =525
                    ColumnStart =1
                    ColumnEnd =1
                    LayoutGroup =1
                    BorderShade =100.0
                    ThemeFontIndex =-1
                    ForeTint =65.0
                    GridlineShade =50.0
                    GroupTable =1
                    Begin
                        Begin Label
                            BackStyle =1
                            OldBorderStyle =1
                            OverlapFlags =223
                            TextFontCharSet =177
                            TextAlign =2
                            TextFontFamily =0
                            Left =180
                            Top =180
                            Width =1095
                            Height =345
                            FontSize =10
                            FontWeight =100
                            TopMargin =58
                            BackColor =-2147483601
                            BorderColor =-2147483601
                            Name ="Etiqueta1613"
                            Caption ="BUSCAR"
                            FontName ="Calibri Light"
                            GroupTable =1
                            LeftPadding =0
                            TopPadding =15
                            RightPadding =0
                            BottomPadding =0
                            GridlineStyleLeft =1
                            GridlineStyleTop =1
                            GridlineStyleBottom =1
                            GridlineColor =6710886
                            LayoutCachedLeft =180
                            LayoutCachedTop =180
                            LayoutCachedWidth =1275
                            LayoutCachedHeight =525
                            LayoutGroup =1
                            ThemeFontIndex =-1
                            BackThemeColorIndex =-1
                            BorderThemeColorIndex =-1
                            BorderTint =100.0
                            ForeThemeColorIndex =1
                            ForeTint =100.0
                            GridlineShade =40.0
                            GroupTable =1
                        End
                    End
                End
                Begin CommandButton
                    TabStop = NotDefault
                    OverlapFlags =215
                    TextFontCharSet =177
                    TextFontFamily =0
                    Left =3675
                    Top =180
                    Width =345
                    Height =345
                    FontSize =12
                    FontWeight =100
                    TabIndex =2
                    ForeColor =5855577
                    Name ="GO_PREVIOUS"
                    Caption ="▴"
                    FontName ="Segoe UI Emoji"
                    OnGotFocus ="[Event Procedure]"
                    ControlTipText ="Anterior"
                    GroupTable =1
                    LeftPadding =0
                    TopPadding =15
                    RightPadding =0
                    BottomPadding =0
                    GridlineStyleTop =1
                    GridlineStyleRight =1
                    GridlineStyleBottom =1
                    GridlineColor =8355711

                    CursorOnHover =1
                    LayoutCachedLeft =3675
                    LayoutCachedTop =180
                    LayoutCachedWidth =4020
                    LayoutCachedHeight =525
                    ColumnStart =2
                    ColumnEnd =2
                    LayoutGroup =1
                    ForeTint =65.0
                    GridlineShade =50.0
                    Shape =0
                    Gradient =0
                    BackThemeColorIndex =1
                    BackTint =100.0
                    BorderThemeColorIndex =1
                    BorderTint =100.0
                    ThemeFontIndex =-1
                    HoverThemeColorIndex =1
                    HoverTint =100.0
                    PressedThemeColorIndex =1
                    PressedShade =100.0
                    HoverForeThemeColorIndex =4
                    HoverForeTint =100.0
                    PressedForeThemeColorIndex =4
                    PressedForeTint =100.0
                    GroupTable =1
                    WebImagePaddingTop =1
                    WebImagePaddingRight =-1
                    WebImagePaddingBottom =-1
                    Overlaps =1
                End
                Begin CommandButton
                    Default = NotDefault
                    TabStop = NotDefault
                    OverlapFlags =223
                    TextFontCharSet =177
                    TextFontFamily =0
                    Left =4035
                    Top =180
                    Width =345
                    Height =345
                    FontSize =12
                    FontWeight =100
                    TabIndex =3
                    ForeColor =5855577
                    Name ="GO_NEXT"
                    Caption ="▾"
                    FontName ="Segoe UI Emoji"
                    OnGotFocus ="[Event Procedure]"
                    ControlTipText ="Siguiente"
                    GroupTable =1
                    LeftPadding =0
                    TopPadding =15
                    RightPadding =0
                    BottomPadding =0
                    GridlineStyleTop =1
                    GridlineStyleRight =1
                    GridlineStyleBottom =1
                    GridlineColor =8355711

                    CursorOnHover =1
                    LayoutCachedLeft =4035
                    LayoutCachedTop =180
                    LayoutCachedWidth =4380
                    LayoutCachedHeight =525
                    ColumnStart =3
                    ColumnEnd =3
                    LayoutGroup =1
                    ForeTint =65.0
                    GridlineShade =50.0
                    Shape =0
                    Gradient =0
                    BackThemeColorIndex =1
                    BackTint =100.0
                    BorderThemeColorIndex =1
                    BorderTint =100.0
                    ThemeFontIndex =-1
                    HoverThemeColorIndex =1
                    HoverTint =100.0
                    PressedThemeColorIndex =1
                    PressedShade =100.0
                    HoverForeThemeColorIndex =4
                    HoverForeTint =100.0
                    PressedForeThemeColorIndex =4
                    PressedForeTint =100.0
                    GroupTable =1
                    WebImagePaddingTop =1
                    WebImagePaddingRight =-1
                    WebImagePaddingBottom =-1
                    Overlaps =1
                End
                Begin EmptyCell
                    Left =4380
                    Top =180
                    Width =165
                    Height =345
                    Name ="CeldaVacía1443"
                    GroupTable =1
                    LeftPadding =0
                    TopPadding =15
                    RightPadding =0
                    BottomPadding =0
                    GridlineColor =10921638
                    LayoutCachedLeft =4380
                    LayoutCachedTop =180
                    LayoutCachedWidth =4545
                    LayoutCachedHeight =525
                    ColumnStart =4
                    ColumnEnd =4
                    LayoutGroup =1
                    GroupTable =1
                End
                Begin CommandButton
                    Cancel = NotDefault
                    OverlapFlags =215
                    TextFontCharSet =177
                    TextFontFamily =0
                    Left =4545
                    Top =180
                    Width =345
                    Height =345
                    FontSize =8
                    FontWeight =100
                    Name ="CLOSE_ME"
                    Caption ="✖"
                    OnClick ="[Event Procedure]"
                    FontName ="Segoe UI Emoji"
                    GroupTable =1
                    LeftPadding =0
                    TopPadding =15
                    RightPadding =0
                    BottomPadding =0
                    GridlineColor =10921638

                    CursorOnHover =1
                    LayoutCachedLeft =4545
                    LayoutCachedTop =180
                    LayoutCachedWidth =4890
                    LayoutCachedHeight =525
                    ColumnStart =5
                    ColumnEnd =5
                    LayoutGroup =1
                    ForeThemeColorIndex =1
                    ForeTint =100.0
                    ForeShade =50.0
                    Shape =0
                    Gradient =0
                    BackThemeColorIndex =1
                    BackTint =100.0
                    BackShade =95.0
                    BorderThemeColorIndex =1
                    BorderTint =100.0
                    BorderShade =95.0
                    ThemeFontIndex =-1
                    HoverThemeColorIndex =1
                    HoverTint =100.0
                    HoverShade =95.0
                    PressedThemeColorIndex =1
                    PressedShade =95.0
                    HoverForeColor =5263615
                    HoverForeThemeColorIndex =-1
                    HoverForeTint =100.0
                    PressedForeThemeColorIndex =1
                    PressedForeTint =100.0
                    GroupTable =1
                    WebImagePaddingTop =1
                    WebImagePaddingRight =-1
                    WebImagePaddingBottom =-1
                    Overlaps =1
                End
                Begin Line
                    OverlapFlags =87
                    Left =5007
                    Width =0
                    Height =743
                    Name ="LineBorderRight"
                    LeftPadding =0
                    TopPadding =0
                    RightPadding =0
                    BottomPadding =0
                    GridlineColor =10921638
                    LayoutCachedLeft =5007
                    LayoutCachedWidth =5007
                    LayoutCachedHeight =743
                    BorderThemeColorIndex =1
                    BorderShade =40.0
                End
            End
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Option Explicit

Private pREx As RecordsetEx
Private pCallback As Callback
Private pDefinedSearch As Variant
Private pSearchBookmark As Variant

Private pGoNextCallStack As Long
Private pGoPrevCallStack As Long
Private pIsRunningTask As Boolean
Private pIsSearchChangeTaskInQueue As Boolean
Private pIsGoTaskInQueue As Boolean
Private pIsCallbackReady As Boolean
Private pIsCallbackPending As Boolean



Property Get IsSubform() As Boolean
    On Error Resume Next
    IsSubform = Len(Me.Parent.Name) > 0
End Property

Public Property Get IsRunningTask() As Boolean: IsRunningTask = pIsRunningTask: End Property
Public Property Let IsRunningTask(ByVal VALOR As Boolean): pIsRunningTask = VALOR: End Property
Public Property Get IsSearchChangeTaskInQueue() As Boolean: IsSearchChangeTaskInQueue = pIsSearchChangeTaskInQueue: End Property
Public Property Let IsSearchChangeTaskInQueue(ByVal VALOR As Boolean): pIsSearchChangeTaskInQueue = VALOR: End Property
Public Property Get IsGoTaskInQueue() As Boolean: IsGoTaskInQueue = pIsGoTaskInQueue: End Property
Public Property Let IsGoTaskInQueue(ByVal VALOR As Boolean): pIsGoTaskInQueue = VALOR: End Property
Public Property Get GoNextCallStack() As Long: GoNextCallStack = pGoNextCallStack: End Property
Public Property Let GoNextCallStack(ByVal VALOR As Long): pGoNextCallStack = VALOR: End Property
Public Property Get GoPrevCallStack() As Long: GoPrevCallStack = pGoPrevCallStack: End Property
Public Property Let GoPrevCallStack(ByVal VALOR As Long): pGoPrevCallStack = VALOR: End Property
Public Property Get IsCallbackReady() As Boolean: IsCallbackReady = pIsCallbackReady: End Property
Public Property Let IsCallbackReady(ByVal VALOR As Boolean): pIsCallbackReady = VALOR: End Property

Private Sub Form_KeyDown(KeyCode As Integer, Shift As Integer)
    'Debug.Print Printf("KeyCode: %1, Shift: %2, ShiftHex: %3", KeyCode, Shift, VBA.Hex$(Shift))
    
    TryHandleKeyboardShortcut Me, KeyCode, Shift
End Sub

Private Sub Form_Load()
    On Error Resume Next
    
    pSearchBookmark = -1
    pDefinedSearch = GenerateSearchDefinition("")
    pGoNextCallStack = 0
    pGoPrevCallStack = 0
    pIsGoTaskInQueue = False
    pIsRunningTask = False
    pIsSearchChangeTaskInQueue = False
    pIsCallbackReady = True
    
    Me.TimerInterval = 0
End Sub

Private Sub Form_Timer()
    On Error GoTo Finally

    If Screen.ActiveForm.hWnd = Me.hWnd Then
        If Not IsRunningTask Then
            If IsSearchChangeTaskInQueue Then
                Me.TimerInterval = 0
                On Error Resume Next
                SearchChangeTask
                Me.TimerInterval = 100
            ElseIf IsGoTaskInQueue Then
                Me.TimerInterval = 0
                On Error Resume Next
                GoTask
                Me.TimerInterval = 100
            Else
                If pIsCallbackPending And IsCallbackReady Then
                    Me.TimerInterval = 0
                    On Error Resume Next
                    ExecuteCallbackOnCurrentRecord pSearchBookmark
                    Me.TimerInterval = 100
                End If
            End If
        End If
        
        Exit Sub
    End If
    
Finally:
    DoCmd.Close acForm, "DS_QUICK_SEARCH"
End Sub

Public Sub Setup(ByRef TargetRecordsetEx As RecordsetEx, ByRef SearchCallback As Callback)
    Set pREx = TargetRecordsetEx.Clone()
    Set pCallback = SearchCallback
    Me.INPUT_SEARCH.SetFocus
    pIsCallbackReady = True
    Me.TimerInterval = 100
End Sub



Private Sub Form_Unload(Cancel As Integer)
    On Error Resume Next
    pCallback.Execute -1
End Sub

Private Sub ExecuteCallbackOnCurrentRecord(ByRef sBookmark As Variant)
    Dim recordIndex As Variant
    
    If Not IsCallbackReady Then
        pIsCallbackPending = True
        Exit Sub
    End If
    IsCallbackReady = False
    pIsCallbackPending = False
    If sBookmark = -1 Then
        recordIndex = -1
    Else
        recordIndex = pREx.Instance.AbsolutePosition - 1
    End If
    
    pCallback.Execute recordIndex, sBookmark
End Sub

Private Sub GO_NEXT_GotFocus()
    On Error Resume Next
    
    Me.INPUT_SEARCH.SetFocus
    GoNextCallStack = GoNextCallStack + 1
    
    If IsRunningTask Then
        IsGoTaskInQueue = True
    Else
        GoTask
    End If
End Sub

Private Sub GO_PREVIOUS_GotFocus()
    On Error Resume Next
    
    Me.INPUT_SEARCH.SetFocus
    GoPrevCallStack = GoPrevCallStack + 1
    
    If IsRunningTask Then
        IsGoTaskInQueue = True
    Else
        GoTask
    End If
End Sub

Private Sub INPUT_SEARCH_Change()
    GoNextCallStack = 0
    GoPrevCallStack = 0
    IsGoTaskInQueue = False
    
    If IsRunningTask Then
        IsSearchChangeTaskInQueue = True
    Else
        If Not IsSearchChangeTaskInQueue Then
            SearchChangeTask
        End If
    End If
End Sub

Private Sub CLOSE_ME_Click()
    OnEscape
End Sub

Public Sub OnEscape()
    On Error Resume Next
    
    DoCmd.Close acForm, "DS_QUICK_SEARCH"
End Sub


Private Sub SearchChangeTask()
    On Error GoTo Finally
    Dim sValue As String
    
    IsRunningTask = True
    sValue = GetControlText(Me.INPUT_SEARCH)
    IsSearchChangeTaskInQueue = False
    pDefinedSearch = GenerateSearchDefinition(sValue)
    pSearchBookmark = pREx.Search(pDefinedSearch)
    IsRunningTask = False
    If Not IsSearchChangeTaskInQueue Then
        ExecuteCallbackOnCurrentRecord pSearchBookmark
    End If
    
    Exit Sub
Finally:
    Debug.Print "UNEXPECTED ERROR IN SearchChangeTask()"
    IsRunningTask = False
End Sub

Private Sub GoTask()
    On Error GoTo Finally
    
    IsRunningTask = True
    If GoNextCallStack > 0 Then
        GoNextCallStack = GoNextCallStack - 1
        pSearchBookmark = pREx.Search(pDefinedSearch, pSearchBookmark, adSearchForward)
    ElseIf GoPrevCallStack > 0 Then
        GoPrevCallStack = GoPrevCallStack - 1
        pSearchBookmark = pREx.Search(pDefinedSearch, pSearchBookmark, adSearchBackward)
    End If
    
Finally:
    IsRunningTask = False
    DoEvents
    If GoNextCallStack <= 0 And GoPrevCallStack <= 0 Then
        IsGoTaskInQueue = False
        ExecuteCallbackOnCurrentRecord pSearchBookmark
    End If
End Sub
